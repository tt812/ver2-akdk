name: Update Keymap Image
on:
  push:
    branches:
      - ver2-akdk
    paths:
      - 'config/*.keymap'
      - 'config/*.yaml'

jobs:
  draw:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install keymap-drawer
        run: pip install keymap-drawer

      - name: Parse and Draw
        run: |
          # configフォルダ内の .keymap で終わるファイルを自動で探して変換します
          keymap parse -z config/*.keymap > keymap_drawn.yaml
          keymap draw keymap_drawn.yaml > keymap_drawn.svg

      - name: Commit and Push
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: self-generate keymap svg"
          file_pattern: "keymap_drawn.svg keymap_drawn.yaml"
